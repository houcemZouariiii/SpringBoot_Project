<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{admin/layout :: layout(~{::content}, 'Séances')}">
<body>
<div th:fragment="content">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1><i class="bi bi-calendar-event"></i> Séances</h1>
    </div>
    <div class="card mb-3">
        <div class="card-body">
            <h5 class="card-title">Planifier une séance</h5>
            <form action="/admin/seances" method="post" class="row g-2">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <div class="col-md-4">
                    <label class="form-label">Cours *</label>
                    <select class="form-select" name="coursId" required>
                        <option value="">Sélectionner</option>
                        <option th:each="c : ${cours}" th:value="${c.id}" th:text="${c.titre}"></option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Formateur *</label>
                    <select class="form-select" name="formateurId" required>
                        <option value="">Sélectionner</option>
                        <option th:each="f : ${formateurs}" th:value="${f.id}" th:text="${f.nomComplet}"></option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Salle</label>
                    <input type="text" class="form-control" name="salle" placeholder="Salle A101">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Début *</label>
                    <input type="datetime-local" class="form-control" name="dateDebut" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Fin *</label>
                    <input type="datetime-local" class="form-control" name="dateFin" required>
                </div>
                <div class="col-12">
                    <label class="form-label">Groupes</label>
                    <select class="form-select" name="groupeIds" multiple size="5">
                        <option th:each="g : ${groupes}" th:value="${g.id}" th:text="${g.code + (g.nom != null ? ' - ' + g.nom : '')}"></option>
                    </select>
                    <small class="text-muted">Ctrl/Cmd + clic pour multi-sélection</small>
                </div>
                <div class="col-12 d-flex justify-content-end">
                    <button class="btn btn-primary"><i class="bi bi-plus-circle"></i> Planifier</button>
                </div>
            </form>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                    <tr>
                        <th>Cours</th>
                        <th>Formateur</th>
                        <th>Début</th>
                        <th>Fin</th>
                        <th>Salle</th>
                        <th>Groupes</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="s : ${seances}">
                        <td th:text="${s.cours.titre}"></td>
                        <td th:text="${s.formateur.nomComplet}"></td>
                        <td th:text="${#temporals.format(s.dateDebut, 'dd/MM/yyyy HH:mm')}"></td>
                        <td th:text="${#temporals.format(s.dateFin, 'dd/MM/yyyy HH:mm')}"></td>
                        <td th:text="${s.salle != null ? s.salle : '-'}"></td>
                        <td>
                            <span th:if="${s.groupes != null && !s.groupes.isEmpty()}" th:each="g,iter : ${s.groupes}">
                                <span class="badge bg-info" th:text="${g.code}"></span>
                                <span th:if="${!iter.last}">&nbsp;</span>
                            </span>
                            <span th:if="${s.groupes == null || s.groupes.isEmpty()}">-</span>
                        </td>
                        <td>
                            <form th:action="@{'/admin/seances/' + ${s.id} + '/delete'}" method="post" class="d-inline">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                <button class="btn btn-sm btn-danger" onclick="return confirm('Supprimer ?')"><i class="bi bi-trash"></i></button>
                            </form>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
</body>
</html>

