<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{admin/layout :: layout(~{::content}, 'Formateur')}">
<body>
    <div th:fragment="content">
        <h1 class="mb-4">
            <span th:text="${formateur.id != null ? 'Modifier le formateur' : 'Nouveau formateur'}"></span>
        </h1>

        <form th:action="${formateur.id != null ? '/admin/formateurs/' + formateur.id : '/admin/formateurs'}" 
              th:object="${formateur}" method="post" class="row g-3" id="formateurForm">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <div class="col-md-6">
                <label class="form-label">Nom *</label>
                <input type="text" class="form-control" th:field="*{nom}" required>
            </div>
            <div class="col-md-6">
                <label class="form-label">Prénom *</label>
                <input type="text" class="form-control" th:field="*{prenom}" required>
            </div>
            <div class="col-md-6">
                <label class="form-label">Email *</label>
                <input type="email" class="form-control" th:field="*{email}" required>
            </div>
            <div class="col-md-6">
                <label class="form-label">Téléphone</label>
                <input type="text" class="form-control" th:field="*{telephone}">
            </div>
            <div class="col-md-6">
                <label class="form-label">Spécialité</label>
                <input type="text" class="form-control" th:field="*{specialite}">
            </div>
            <div class="col-md-6">
                <label class="form-label">Années d'expérience</label>
                <input type="number" class="form-control" th:field="*{anneesExperience}">
            </div>
            <div class="col-md-6">
                <label class="form-label">Nom d'utilisateur *</label>
                <input type="text" class="form-control" th:field="*{username}" required>
                <small class="text-muted">Utilisé pour la connexion</small>
            </div>
            <div class="col-md-6">
                <label class="form-label">Mot de passe <span th:if="${formateur.id == null}">*</span></label>
                <input type="password" class="form-control" th:field="*{password}" 
                       th:required="${formateur.id == null}"
                       th:minlength="${formateur.id == null ? 6 : 0}"
                       placeholder="Minimum 6 caractères">
                <small class="text-muted" th:if="${formateur.id == null}">Minimum 6 caractères requis</small>
                <small class="text-muted" th:if="${formateur.id != null}">Laissez vide pour ne pas modifier</small>
            </div>
            <div class="col-12">
                <div class="d-flex gap-2 justify-content-end">
                    <a href="/admin/formateurs" class="btn btn-secondary btn-sm">Annuler</a>
                    <button type="submit" class="btn btn-success btn-sm" id="submitBtn">Enregistrer</button>
                </div>
            </div>
        </form>
        
        <script>
            document.getElementById('formateurForm').addEventListener('submit', function(e) {
                const usernameInput = document.querySelector('input[name="username"]');
                const passwordInput = document.querySelector('input[name="password"]');
                const isNew = /*[[${formateur.id == null}]]*/ true;
                
                if (isNew && usernameInput && passwordInput) {
                    const username = usernameInput.value.trim();
                    const password = passwordInput.value.trim();
                    
                    if (!username || username.length < 3) {
                        e.preventDefault();
                        alert('Le nom d\'utilisateur est obligatoire et doit contenir au moins 3 caractères.');
                        usernameInput.focus();
                        return false;
                    }
                    if (!password || password.length < 6) {
                        e.preventDefault();
                        alert('Le mot de passe est obligatoire et doit contenir au moins 6 caractères.');
                        passwordInput.focus();
                        return false;
                    }
                }
                
                const submitBtn = document.getElementById('submitBtn');
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> Enregistrement...';
                }
            });
        </script>
    </div>
</body>
</html>

